<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Pragma" content="no-cache">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>新增清单</title>
		<link rel="stylesheet" type="text/css" href="../../css/reset.css" />
		<link rel="stylesheet" type="text/css" href="../../css/yywtab.css" />
		<script src="../../public/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../public/rem.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../public/public.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<div class="xzlisthead">
			<div class="xzlistwrapimg" onClick="javascript :history.back(-1);">
				<img src="../../images/return@3x.png" />
			</div>
			<p id="xztitle"></p>
		</div>
		<div id="cdconts" v-cloak>
			<div class="xzlisttab">
				<div class="xztabs">
					<p class="xzlactive" @click="tabs1($event)">分省统计</p>
					<p @click="tabs2($event)">客户清单</p>
				</div>
			</div>
			<div class="xzlistcont">
				<div class="xzlistcont1">
					<div class="wrapxztab">
						<div class="wrapxztabhead" v-on:scroll="scroll1($event)">
							<p>
								<span v-for="items in datalists10">
									{{items}}
								<span>
							</p>
						</div>
						<div class="wrapxztablist" v-on:scroll="scroll2($event)">
							<p v-for="(datalist,index) in datalists1">
								<span v-for='items in datalist.columnList.columnValue'>
									{{items}}
								<span>
							</p>
						</div>
					</div>
				</div>
				<div class="xzlistcont2">
					<div class="xzkhlisttop">
						<p class="wrapxzsrc">
							<img src="../../images/xzlistsrc_03.png" />
							<input type="text" id="xzusercont" placeholder="客户名称" @input="changes($event)"/>
							<button @click="tabs22()">查询</button>
						</p>
						<p class="xzlisttop2">
							<span>省份</span>
								<span>客户名称</span>
								<span>场景</span>
								<span>新增(户)</span>
							</p>
						</div>
						<div class="xzkhlistcont" id="div1" v-on:scroll="scroll4()">
							<p v-for="(datalist,index) in datalists2" v-bind:class="(index%2 ==0) ? 'odds' : 'evens'">
								<span>{{datalist.provinceName}}</span>
								<span><i class="mingcheng">{{datalist.customerName}}</i></span>
								<span>{{datalist.scene}}</span>
								<span>{{datalist.cumulativeAddCount}}</span>
							</p>
						</div>
					</div>
				</div>
			</div>
	</body>
	<script src="../../public/layer.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../public/vue.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		var loginname = localStorage.getItem("loginname");
		$(".xzlistcont2").hide()
		var nowname = getQueryString("name");
		var quhang = "";
		if(nowname == 'zw') {
			$("#xztitle").text('政务行业')
			quhang = "AA"
		} else if(nowname == 'yw') {
			$("#xztitle").text('医疗卫生')
			quhang = "EE"
		} else if(nowname == 'jt') {
			$("#xztitle").text('交通物流')
			quhang = "CC"
		} else if(nowname == 'jr') {
			$("#xztitle").text('金融行业')
			quhang = "DD"
		} else if(nowname == 'xx') {
			$("#xztitle").text('服务行业')
			quhang = "BB"
		} else if(nowname == 'ny') {
			$("#xztitle").text('现代农业')
			quhang = "II"
		} else if(nowname == 'gy') {
			$("#xztitle").text('制造能源')
			quhang = "FF"
		}
		var time0 = localStorage.getItem("xztime0");
		var time1 = localStorage.getItem("xztime1");
		var datas = {
			"ContractRoot": {
				"TcpCont": {
					"BusCode": "OPP10129",
					"TransactionID": "2017091716263709329",
					"TimeStamp": "20170917162637"
				},
				"SvcCont": {
					"ReqInfo": {
						"QueryType": quhang,
						"LoginName": loginname,
						"EndTime": time1,
						"SystemID": "1212",
						"StartTime": time0
					}
				}
			}
		}
		new Vue({
			el: "#cdconts",
			data: {
				datalists1: [],
				datalists2: [],
				datalists10: [],
				usersrc: "",
				widths: "",
				pagenumbs: 1,
				scrolly: 0,
				asking: true,
			},
			mounted: function() {
				var arr = this;
				$.ajax({
					url: publicurl + JSON.stringify(datas),
					dataType: 'json',
					type: 'get',
					success: function(data) {
						layer.close(index);
						console.log(data)
						if(data.msg) {
							alert("网络出现异常，请重试")
						} else {
							if(data.ContractRoot.svcCont.respInfo.code == 000) {
								var datas = data.ContractRoot.svcCont.respInfo.rowLlist;
								arr.datalists10 = data.ContractRoot.svcCont.respInfo.rowLlist[0].columnList.columnValue;
								for(var i = 1; i < datas.length; i++) {
									arr.datalists1.push(datas[i])
								}
								arr.widths = (data.ContractRoot.svcCont.respInfo.rowLlist[0].columnList.columnValue.length) * 2 + "rem";
							} else {
								alert("网络出现异常，请重试")
							}
						}
					},
					beforeSend: function(request) {
						index = layer.open({
							style: 'border:none; color:#fff;',
							content: '玩命加载中...',
							shadeClose: false,
						})
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						alert("网络出现异常，请重试")
						layer.close(index);
					},
				});
			},
			updated: function() {
				var arr = this;
				arr.$nextTick(function() {
					$(".wrapxztab p").css({
						'width': arr.widths
					})
					$(".wrapxztab p:even").css({
						'background': '#fff'
					})
					$(".wrapxztab p:odd").css({
						'background': '#f2f2f2'
					})
				})
			},
			methods: {
				tabs1: function(e) {
					var arr = this;
					arr.datalists1 = [];
					$.ajax({
						url: publicurl + JSON.stringify(datas),
						dataType: 'json',
						type: 'get',
						success: function(data) {
							layer.close(index);
							console.log(data)
							if(data.msg) {
								alert("网络出现异常，请重试")
							} else {
								if(data.ContractRoot.svcCont.respInfo.code == 000) {
									var datas = data.ContractRoot.svcCont.respInfo.rowLlist;
									arr.datalists10 = data.ContractRoot.svcCont.respInfo.rowLlist[0].columnList.columnValue;
									console.log(arr.datalists10)
									for(var i = 1; i < datas.length; i++) {
										arr.datalists1.push(datas[i])
									}
									arr.widths = (data.ContractRoot.svcCont.respInfo.rowLlist[0].columnList.columnValue.length) * 2 + "rem";
								} else {
									alert("网络出现异常，请重试")
								}
							}
						},
						error: function(XMLHttpRequest, textStatus, errorThrown) {
							//							alert("网络出现异常，请重试")
						}
					});
					$(".xzlistcont1").show()
					$(".xzlistcont2").hide()
					$(e.currentTarget).addClass("xzlactive").siblings().removeClass("xzlactive")
				},
				tabs2: function(e) {
					$(".xzlistcont2").show()
					$(".xzlistcont1").hide()
					$(e.currentTarget).addClass("xzlactive").siblings().removeClass("xzlactive");
					var arr = this;
					var datas2 = {
						"ContractRoot": {
							"TcpCont": {
								"BusCode": "OPP10130",
								"TransactionID": "2017091716263707802",
								"TimeStamp": "20170917162637"
							},
							"SvcCont": {
								"ReqInfo": {
									"QueryType": quhang,
									"EndTime": time1,
									"SystemID": "1212",
									"StartTime": time0,
									"LoginName": loginname,
									"PageNum": "200",
									"ThisPage": "1",
									"CustName": arr.usersrc,
								}
							}
						}
					}
					$.ajax({
						url: publicurl + JSON.stringify(datas2),
						dataType: 'json',
						type: 'get',
						success: function(data) {
							layer.close(index);
							if(data.msg) {
								alert("网络出现异常，请重试")
							} else {
								if(data.ContractRoot.svcCont.respInfo.code == 000) {
									arr.datalists2 = data.ContractRoot.svcCont.respInfo.cumulativeAddList;
									console.log(arr.datalists2)
								} else {
									alert("网络出现异常，请重试")
								}
							}
						},
						beforeSend: function(request) {
							index = layer.open({
								style: 'border:none; color:#fff;',
								content: '玩命加载中...',
								shadeClose: false,
							})
						},
						error: function(XMLHttpRequest, textStatus, errorThrown) {
							alert("网络出现异常，请重试")
							layer.close(index);
						},
					});
				},
				changes: function(e) {
					var arr = this;
					arr.usersrc = $(e.currentTarget).val()
					console.log($(e.currentTarget).val())
				},
				tabs22: function() {
					var arr = this;
					console.log(arr.usersrc)
					var datas3 = {
						"ContractRoot": {
							"TcpCont": {
								"BusCode": "OPP10130",
								"TransactionID": "2017091716263707802",
								"TimeStamp": "20170917162637"
							},
							"SvcCont": {
								"ReqInfo": {
									"QueryType": quhang,
									"EndTime": time1,
									"SystemID": "1212",
									"StartTime": time0,
									"LoginName": loginname,
									"PageNum": "200",
									"ThisPage": "1",
									"CustName": arr.usersrc,
								}
							}
						}
					}
					$.ajax({
						url: publicurl + JSON.stringify(datas3),
						dataType: 'json',
						type: 'get',
						success: function(data) {
							layer.close(index);
							if(data.msg) {
								alert("网络出现异常，请重试")
							} else {
								if(data.ContractRoot.svcCont.respInfo.code == 000) {
									arr.datalists2 = data.ContractRoot.svcCont.respInfo.cumulativeAddList;
									console.log(data)
								} else {
									alert("网络出现异常，请重试")
								}
							}
						},
						beforeSend: function(request) {
							index = layer.open({
								style: 'border:none; color:#fff;',
								content: '玩命加载中...',
								shadeClose: false,
							})
						},
						error: function(XMLHttpRequest, textStatus, errorThrown) {
							alert("网络出现异常，请重试")
							layer.close(index);
						},
					});
				},
				scroll1: function(e) {
					$(".wrapxztablist").scrollLeft($(e.currentTarget).scrollLeft());
				},
				scroll2: function(e) {
					$(".wrapxztabhead").scrollLeft($(e.currentTarget).scrollLeft());
				},
				scroll4: function() {
					var arr = this;
					var curY = $("#div1").scrollTop();
					var obj = document.getElementById("div1")
					if(obj.scrollHeight > obj.clientHeight || obj.offsetHeight > obj.clientHeight) {
						if(curY != arr.scrolly) {
							if(arr.asking) {
								var nScrollHight = 0; //滚动距离总长(注意不是滚动条的长度)
								var nScrollTop = 0; //滚动到的当前位置
								var nDivHight = $("#div1").height();
								nScrollHight = $("#div1")[0].scrollHeight;
								nScrollTop = $("#div1")[0].scrollTop;
								console.log(arr.scrolly)
								if(nScrollTop + nDivHight >= nScrollHight - 5) {
									arr.asking = false;
									arr.pagenumbs += 1;
									var datas2 = {
										"ContractRoot": {
											"TcpCont": {
												"BusCode": "OPP10130",
												"TransactionID": "2017091716263707802",
												"TimeStamp": "20170917162637"
											},
											"SvcCont": {
												"ReqInfo": {
													"QueryType": quhang,
													"EndTime": time1,
													"SystemID": "1212",
													"StartTime": time0,
													"LoginName": loginname,
													"PageNum": "200",
													"ThisPage": String(arr.pagenumbs),
													"CustName": arr.usersrc,
												}
											}
										}
									}
									$.ajax({
										url: publicurl + JSON.stringify(datas2),
										dataType: 'json',
										type: 'get',
										success: function(data) {
											layer.close(index);
											if(data.msg) {
												alert("网络出现异常，请重试")
												arr.asking = true;
											} else {
												if(data.ContractRoot.svcCont.respInfo.code == 000) {
													//													arr.datalists2 = data.ContractRoot.svcCont.respInfo.cumulativeAddList;
													var datass = data.ContractRoot.svcCont.respInfo.cumulativeAddList;
													console.log(datass)
													arr.datalists2 = arr.datalists2.concat(datass)
													arr.asking = true;
													if(datass.length == 0) {
														var index2 = layer.open({
															style: 'border:none; color:#fff;',
															content: '无更多数据...',
														})
														setTimeout(function() {
															layer.close(index2);
														}, 1000)
													}
												} else {
													alert("网络出现异常，请重试")
													arr.asking = true;
												}
											}
										},
										beforeSend: function(request) {
											index = layer.open({
												style: 'border:none; color:#fff;',
												content: '玩命加载中...',
												shadeClose: false,
											})
										},
										error: function(XMLHttpRequest, textStatus, errorThrown) {
											layer.close(index);
											arr.asking = true;
										},
									});
								}
								arr.scrolly = curY;
							}
						}
					}

				}
			}

		})
	</script>

</html>