<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="Bookmark" href="/favicon.ico">
		<link rel="Shortcut Icon" href="/favicon.ico" />
		<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
		<script type="text/javascript">
			var token = "token."+sessionStorage.getItem("token");
			if(token=="token.null"){
				alert('请登录');
				location.href="login.html";
			}
		</script>
		<link rel="stylesheet" type="text/css" href="../static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="../static/lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/style.css" />
		<script type="text/javascript" src="../static/lib/public.js"></script>
		<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
		<!--/meta 作为公共模版分离出去-->

		<title>修改用户密码 </title>
		<meta name="keywords" content="">
		<meta name="description" content="">
	</head>

	<body>
		<article class="page-container">
			<form class="form form-horizontal" id="form-change-password">
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>原密码：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="password" class="input-text" autocomplete="off" placeholder="请输入原密码" name="oldpassword" id="oldpassword">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>新密码：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="password" class="input-text" autocomplete="off" placeholder="请输入新密码" name="newpassword" id="newpassword">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>确认密码：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="password" class="input-text" autocomplete="off" placeholder="确认新密码" name="newpassword2" id="new-password2">
					</div>
					<!--<div class="pwd_wrn text-c">*6-16位含有小写字母、大写字母、数字、特殊符号的两种及以上</div>-->
				</div>
				<div class="row cl text-c">
					<div class="text-c">
						<a href="javascript:void(0)" class="type_a type_phone">使用手机号修改密码</a>
					</div>
				</div>
				<div class="row cl">
					<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
						<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;确认修改&nbsp;&nbsp;" id="submit">
					</div>
				</div>
			</form>
			<form class="form form-horizontal hide" id="form-change-password-1">
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>手机号码：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" class="input-text" autocomplete="off" placeholder="请输入手机号" name="phonenumber" id="phonenumber">
						<i class="text_icon">发送验证码</i>
						<span class="time_out">重新发送 <i></i></span>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>验证码：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" class="input-text" autocomplete="off" placeholder="请输入验证码" name="testword" id="testword">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>新密码：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="password" class="input-text" autocomplete="off" placeholder="请输入新密码" name="newpassword" id="newpassword_1">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>确认密码：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="password" class="input-text" autocomplete="off" placeholder="确认新密码" name="newpassword2" id="new-password2">
					</div>
				</div>
				<div class="row cl text-c">
					<div class="text-c">
						<a href="javascript:void(0)" class=" type_a type_pasd">使用原密码进行修改</a>
					</div>
				</div>
				<div class="row cl">
					<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
						<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;确认修改&nbsp;&nbsp;" id="submit">
					</div>
				</div>
			</form>
		</article>

		<!--_footer 作为公共模版分离出去-->
		<script type="text/javascript" src="../static/lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="../static/lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="../static/h-ui/js/H-ui.min.js"></script>
		<script type="text/javascript" src="../static/h-ui.admin/js/H-ui.admin.js"></script>
		<!--/_footer /作为公共模版分离出去-->

		<!--请在下方写此页面业务相关的脚本-->
		<script type="text/javascript" src="../static/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
		<script type="text/javascript" src="../static/lib/jquery.validation/1.14.0/validate-methods.js"></script>
		<script type="text/javascript" src="../static/lib/jquery.validation/1.14.0/messages_zh.js"></script>
		<script type="text/javascript" src="../static/lib/jquery.bootstrap.min.js"></script>

		<script type="text/javascript">
			$(function() {
				var crmid = getQueryString("crmid");
				var timenum = 60;
				$('.time_out i').html(timenum);
				//切换修改方式
				$('.type_phone').click(function() {
					$('#form-change-password').addClass('hide');
					$('#form-change-password-1').removeClass('hide');
				})

				$('.type_pasd').click(function() {
					$('#form-change-password-1').addClass('hide');
					$('#form-change-password').removeClass('hide');
				})

				//发送验证码
				$('.text_icon').click(function() {
					var phoneNum = $('#phonenumber').val();
					if(isPhoneNo(phoneNum)) {
						$.ajax({
							type: "get",
							url: url_r + "/callSalesApp/getSMS",
							headers: {
								Authorization: token
							},
							data: {
								Mobile: phoneNum,
								Orig: 'PWDFGT'

							},
							async: true,
							dataType: 'json',
							success: function(data) {
								if(data.SvcCont.RespInfo.Result == 0) {
									$('.text_icon').hide();
									$('.time_out').show();

									var time = setInterval(function() {
										if(timenum > 0) {
											timenum--;
											$('.time_out i').html(timenum);
										} else if(timenum <= 0) {
											clearInterval(time);
											$('.text_icon').show();
											$('.time_out').hide();
										}
									}, 1000)
								}
							},
							error: function() {
								layer.msg('请求失败!', {
									icon: 2,
									time: 1000
								});
							}
						});
					} else {
						layer.msg('手机号码不正确', {
							icon: 2,
							time: 1000
						});
					}

				})

				//第一种修改方式
				$("#form-change-password").validate({
					rules: {
						newpassword: {
							required: true,
							minlength: 6,
							maxlength: 16,
							isPwd: true
						},
						newpassword2: {
							required: true,
							minlength: 6,
							maxlength: 16,
							isPwd: true,
							equalTo: "#newpassword"
						},
					},
					onkeyup: false,
					focusCleanup: true,
					success: "valid",
					submitHandler: function(form) {
						var formId = $(form).attr('id');
						var data = {};
						var account = crmid;
						var oldPWD = $(form).find('#oldpassword').val();
						var newPWD = $(form).find('#newpassword').val();
						var confirmPWD = $(form).find('#new-password2').val();
						data.updateFlag = 1;
						data.account = account;
						data.oldPWD = oldPWD;
						data.newPWD = newPWD;
						data.confirmPWD = confirmPWD;
						$.ajax({
							url: url_r + '/callSalesApp/updatePassword',
							headers: {
								Authorization: token
							},
							type: 'get',
							data: data,
							success: function(data) {
								var data = JSON.parse(data);
								if(data.SvcCont.RespInfo.Result == 0) {
									layer.msg('修改成功!', {
										icon: 1,
										time: 1000
									});
									setTimeout(function() {
										var index = parent.layer.getFrameIndex(window.name);
										parent.$('.r')[0].click();
										parent.layer.close(index);
									}, 1000);

								} else {
									layer.msg(data.SvcCont.RespInfo.Msg, {
										icon: 2,
										time: 1000
									});
								}
							},
							error: function() {
								layer.msg('请求失败!', {
									icon: 2,
									time: 1000
								});
							}
						});
					}
				});

				//第二种修改方式
				$("#form-change-password-1").validate({
					rules: {
						phonenumber: {
							required: true,
							isMobile: true
						},
						testword: {
							required: true,
						},
						newpassword: {
							required: true,
							minlength: 6,
							maxlength: 16,
							isPwd: true
						},
						newpassword2: {
							required: true,
							minlength: 6,
							maxlength: 16,
							isPwd: true,
							equalTo: "#newpassword_1"
						},
					},
					onkeyup: false,
					focusCleanup: true,
					success: "valid",
					submitHandler: function(form) {
						var data = {};
						var account = $(form).find('#phonenumber').val();
						var newPWD = $(form).find('#newpassword_1').val();
						var confirmPWD = $(form).find('#new-password2').val();
						data.updateFlag = 0;
						data.account = account;
						data.SMS = $(form).find('#testword').val();
						data.newPWD = newPWD;
						data.confirmPWD = confirmPWD;
						$.ajax({
							url: url_r + '/callSalesApp/updatePassword',
							headers: {
								Authorization: token
							},
							type: 'get',
							data: data,
							success: function(data) {
								var data = JSON.parse(data);
								if(data.SvcCont.RespInfo.Result == 0) {
									layer.msg('修改成功!', {
										icon: 1,
										time: 1000
									});
									setTimeout(function() {
										var index = parent.layer.getFrameIndex(window.name);
										parent.$('.r')[0].click();
										parent.layer.close(index);
									}, 1000);

								} else {
									layer.msg(data.SvcCont.RespInfo.Msg, {
										icon: 2,
										time: 1000
									});
								}
							},
							error: function() {

							}
						});
					}
				});
			});
		</script>
		<!--/请在上方写此页面业务相关的脚本-->
	</body>

</html>